---
title: "How predictable are the FIFA World Cup outcomes? An empirical analysis"
author: "Thomas Fernandes"
date: "2023-04-12"
output:
  html_document:
    toc: yes
    toc_depth: '2'
    toc_float: true
    df_print: paged
    theme: flatly
    css: styles.css
---

<style>
.justify {
  text-align: justify;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(readr)
library(plotly)
library(stargazer)
library(lmtest)
library(car)
library(webshot)
library(htmltools)
library(margins)
library(sandwich)
```


# 1. Introduction

__Applied Economics Letters__, 2008, 15, 1171–1176, *Saumik Paul and Ronita Mitra*

## 1.1 Ce que dit l'article

<p class="justify">Cet article examine la prévisibilité des résultats de la Coupe du monde de football en utilisant deux modèles empiriques. Depuis 1993, le système de classement mensuel de la FIFA (couramment appelé coefficient des pays) pour les équipes nationales de football seniors est devenu une source fiable pour juger du potentiel d'une équipe dans la compétition. Cependant, l'article montre que, malgré le nombre de surprises dans les résultats des matchs, les équipes les mieux classées ont généralement de meilleures performances. Les auteurs analysent les résultats des quatre Coupes du monde de la FIFA de 1994 à 2006 et utilisent les classements mensuels de la FIFA pour évaluer les performances des équipes. Deux modèles empiriques sont proposés : un modèle de régression linéaire et un modèle probit. Le premier modèle utilise la différence de buts comme variable expliquée pour voir si les équipes les mieux classées ont généralement des meilleures performances, tandis que le second évalue la probabilité de victoire pour chaque équipe en fonction de son classement FIFA et ainsi que d'autres variables de contrôles. Les auteurs trouvent des preuves empiriques que, malgré les surprises occasionnelles, les équipes les mieux classées ont généralement de meilleures performances.</p>

## 1.2 Ce qu'on cherche à faire

<p class="justify">L'objectif de cette étude est de répliquer les résultats de l'article en utilisant les mêmes données que les auteurs, ainsi que des données plus récentes. Cependant, certaines variables de contrôle utilisées dans l'article original ne sont pas disponibles pour la période de 2006 à 2022, telles que le nombre de corners et le nombre d'arrêts pour 2022. Ainsi, afin de pallier à cette lacune, nous avons sélectionné d'autres indicateurs pertinents pour les remplacer, tout en ajoutant de nouveaux, tels que le nombre de changements effectués par chaque équipe, le nombre total de tirs en plus du nombre de tirs cadrés, ainsi que le nombre d'arrêts. En utilisant ces variables alternatives, nous avons cherché à savoir si les conclusions de l'article original pouvaient être étendues à une période plus récente de la Coupe du monde de football. Nous avons également mis à l'épreuve la validité de la méthode de classement de la FIFA et de son utilisation en tant que proxy pour la performance des équipes.</p>

# 2. Traitement des données

<p class="justify">Les données liées aux coupes du monde n'étant officiellement plus disponible gratuitement sur le site de la FIFA, il faut se baser sur des données d'utilisateurs qui ont scrap le site de la FIFA dans l'objectif de répliquer ces bases de données.

- Matchs : https://www.kaggle.com/datasets/piterfm/fifa-football-world-cup — *Petro Ivaniuk*. Statistiques de base (buts, affluence, cartons) sur tous les matchs de Coupe du Monde depuis la première édition en 1930.
      
- Matchs_stats: https://www.kaggle.com/datasets/kaito510/fifa-world-cup-match-stats — *Kaito G.*. Statistiques complémentaires sur les match internationaux de 2001 à 2021. Contient les variables de contrôle de possession de balle, de tirs et tirs cadrés, des arrêts ainsi que des fautes.

- Coupe du monde 2022 : https://www.kaggle.com/datasets/die9origephit/fifa-world-cup-2022-complete-dataset — *Diego Farchione*. Base de données complète de la Coupe du Monde 2022.

- Classement FIFA : https://www.kaggle.com/datasets/cashncarry/fifaworldranking — *Alex Zabrodin*. Classement FIFA depuis son introduction en 1994 jusqu'à aujourd'hui.</p>

## 2.1 Traitement des données de match

<p class="justify">Les statistiques liées à un match sont enregistrées ranger en chaîne de caractères. Pour intégrer ces données à notre modèle, nous avons dû les convertir en variables numériques. Nous avons utilisé la fonction sapply() pour appliquer la fonction strsplit() à chaque élément de la liste des données. Cette fonction strsplit() permet de diviser les éléments des chaînes de caractères selon un séparateur prédéfini.</p>

```{r}
WC_matches <- read.csv("WC Data/matches_1930_2022 (All).csv",
                    header = TRUE,
                    sep = ",",
                    stringsAsFactors = FALSE)

WC_matches <- WC_matches[c("home_team", "away_team", "home_score",
                           "away_score", "Attendance", "Round",
                           "Year", "home_red_card", "away_red_card",
                           "home_yellow_card_long", "away_yellow_card_long",
                           "home_substitute_in_long", "away_substitute_in_long")]

#Renomme les colonnes
colnames(WC_matches) <- c("Home", "Away", "Home.Goals", "Away.Goals",
                          "Attendance", "Round", "Year", "Home.Red.Card",
                          "Away.Red.Card", "Home.Yellow.Card",
                          "Away.Yellow.Card", "Home.Substitute.In",
                          "Away.Substitute.In")

#On extrait les variables de contrôles des string, et on créé les variables en différence
WC_matches$Goals_Diff             <- WC_matches$Home.Goals - WC_matches$Away.Goals
WC_matches$Home.Red.Card.Count    <- sapply(strsplit(WC_matches$Home.Red.Card, "\\|"),
                                            function(x) length(x))
WC_matches$Away.Red.Card.Count    <- sapply(strsplit(WC_matches$Away.Red.Card, "\\|"),
                                            function(x) length(x))
WC_matches$Red.Card.Diff          <- WC_matches$Home.Red.Card.Count - WC_matches$Away.Red.Card.Count
WC_matches$Home.Yellow.Card.Count <- sapply(strsplit(WC_matches$Home.Yellow.Card, ","),
                                            function(x) length(x))
WC_matches$Away.Yellow.Card.Count <- sapply(strsplit(WC_matches$Away.Yellow.Card, ","),
                                            function(x) length(x))
WC_matches$Yellow.Card.Diff       <- WC_matches$Home.Yellow.Card.Count - WC_matches$Away.Yellow.Card.Count
WC_matches$Home.Substitution.Count<- sapply(strsplit(WC_matches$Home.Substitute.In, ","),
                                            function(x) length(x))
WC_matches$Away.Substitution.Count<- sapply(strsplit(WC_matches$Away.Substitute.In, ","),
                                            function(x) length(x))
WC_matches$Substitution.Diff      <- WC_matches$Home.Substitution.Count - WC_matches$Away.Substitution.Count

WC_database <- WC_matches
WC_database <- subset(WC_database, Year >= 1994)

#Suppression des colonnes inutiles
WC_database <- WC_database[,-c(8,9,10,11,12, 13)]
```

## 2.2 Traitement des données de match supplémentaires

<p class="justify">Nous disposons de données supplémentaires pour les matchs les plus récents, à partir de la Coupe du Monde 2006, qui incluent la possession de balle, le nombre de tirs, de tirs cadrés, de fautes et d'arrêts. Ces données sont considérées comme des variables de contrôle pour notre modèle.</p>

```{r}
WC_matches_stats <- read.csv("WC Data/FIFAallMatchBoxData (Possesion 2001-2021).csv",
                    header = TRUE,
                    sep = ",",
                    stringsAsFactors = FALSE)

#On ne garde que les années de coupe du monde
WC_matches_stats <- subset(WC_matches_stats, year %in% c(2006, 2010,
                                                         2014, 2018, 2022))

#Uniformisation des noms de pays
WC_matches_stats <- WC_matches_stats %>% 
  mutate(hname = ifelse(hname == "South Korea", "Korea Republic", hname))
WC_matches_stats <- WC_matches_stats %>%
  mutate(aname = ifelse(aname == "South Korea", "Korea Republic", aname))
WC_matches_stats <- WC_matches_stats %>% 
  mutate(hname = ifelse(hname == "Ivory Coast", "Côte d'Ivoire", hname))
WC_matches_stats <- WC_matches_stats %>%
  mutate(aname = ifelse(aname == "Ivory Coast", "Côte d'Ivoire", aname))
WC_matches_stats <- WC_matches_stats %>% 
  mutate(hname = ifelse(hname == "Serbia & Montenegro", "Serbia and Montenegro", hname))
WC_matches_stats <- WC_matches_stats %>%
  mutate(aname = ifelse(aname == "Serbia & Montenegro", "Serbia and Montenegro", aname))
WC_matches_stats <- WC_matches_stats %>%
  mutate(hname = ifelse(hname == "North Korea", "Korea DPR", hname))

#Ajout des différences pour les nouvelles statistiques
WC_matches_stats <- WC_matches_stats %>% 
  mutate(Possession.Diff = hPossesion - aPossesion)
WC_matches_stats <- WC_matches_stats %>% 
  mutate(Shots.Diff = hshots - ashots)
WC_matches_stats <- WC_matches_stats %>% 
      mutate(Shots.On.Target.Diff = hshotsOnTarget - ashotsOnTarget)
WC_matches_stats <- WC_matches_stats %>% 
      mutate(Fouls.Diff = hfouls - afouls)
WC_matches_stats <- WC_matches_stats %>% 
      mutate(Saves.Diff = hsaves - asaves)

#Jointure de toutes les données dans le dataframe
WC_database_2 <- merge(WC_database, WC_matches_stats, 
                       by.x = c("Home", "Away", "Year"),
                       by.y = c("hname", "aname", "year"),
                       all.x = TRUE)
WC_database <- WC_database_2
rm(WC_database_2)


#Suppression des colonnes en double
WC_database <- subset(WC_database, select = -c(hgoals, agoals, hyellowCards,
                                               ayellowCards, hredCards, aredCards))
```

## 2.3 Traitement des données de la coupe du monde 2022

<p class="justify">Les données relatives à la dernière Coupe du monde ne sont pas intégrées dans les bases de données précédemment utilisées. Pour résoudre ce problème, nous allons utiliser une nouvelle base de données et la structurer de la même manière que WC_database. Cette manipulation nous permettra ensuite d'effectuer une jointure entre les deux bases. On privilégiera une boucle for plutôt que la fonction merge() pour limiter les erreurs. Cela correspond à un LEFT JOIN.</p>

```{r}
WC_matches_2022 <- read.csv("WC Data/Fifa_world_cup_matches_2022 (Cards).csv",
                    header = TRUE,
                    sep = ",",
                    stringsAsFactors = FALSE)

#On ajoute une colonne Year pour pouvoir merge avec les autres données
WC_matches_2022$Year <- 2022

#Colonnes de différence
WC_matches_2022$Goals_Diff       <- WC_matches_2022$number.of.goals.team1 - WC_matches_2022$number.of.goals.team2
WC_matches_2022$Yellow_Card_Diff <- WC_matches_2022$yellow.cards.team1 - WC_matches_2022$yellow.cards.team2
WC_matches_2022$Red_Card_Diff    <- WC_matches_2022$red.cards.team1 - WC_matches_2022$red.cards.team2

WC_matches_2022$possession.team1 <- gsub("%", "", WC_matches_2022$possession.team1)
WC_matches_2022$possession.team2 <- gsub("%", "", WC_matches_2022$possession.team2)
WC_matches_2022$possession.team1 <- as.numeric(WC_matches_2022$possession.team1)
WC_matches_2022$possession.team2 <- as.numeric(WC_matches_2022$possession.team2)
WC_matches_2022$Possession.Diff  <- WC_matches_2022$possession.team1 - WC_matches_2022$possession.team2

WC_matches_2022$Shots.Diff       <- WC_matches_2022$total.attempts.team1 - WC_matches_2022$total.attempts.team2
WC_matches_2022$Shots.On.Target.Diff <- WC_matches_2022$on.target.attempts.team1 - WC_matches_2022$on.target.attempts.team2

#Les colonnes fouls sont en "against" et non "committed by", on renomme pour inverser
names(WC_matches_2022)[names(WC_matches_2022) == "fouls.against.team1"] <- "fouls.team1"
names(WC_matches_2022)[names(WC_matches_2022) == "fouls.against.team2"] <- "fouls.team2"
WC_matches_2022$Fouls.Diff <- WC_matches_2022$fouls.team1 - WC_matches_2022$fouls.team2

#Suppression des colonnes inutiles
WC_matches_2022_22 <- subset(WC_matches_2022, select = c(1:7, 11, 12, 21, 22, 57:62, 89:96))

#Uniformisation des nom de pays
WC_matches_2022_22 <- WC_matches_2022_22 %>% 
  mutate(team1 = ifelse(team1 == "IRAN", "IR IRAN", team1))
WC_matches_2022_22 <- WC_matches_2022_22 %>%
  mutate(team2 = ifelse(team2 == "IRAN", "IR IRAN", team2))

#On renomme les colonnes pour qu'elles soient identiques à celles de WC_database
names(WC_matches_2022_22)[names(WC_matches_2022_22) == "team1"]                 <- "Home"
names(WC_matches_2022_22)[names(WC_matches_2022_22) == "team2"]                 <- "Away"
names(WC_matches_2022_22)[names(WC_matches_2022_22) == "number.of.goals.team1"] <- "Home.Goals"
names(WC_matches_2022_22)[names(WC_matches_2022_22) == "number.of.goals.team2"] <- "Away.Goals"
names(WC_matches_2022_22)[names(WC_matches_2022_22) == "yellow.cards.team1"]    <- "Home.Yellow.Card.Count"
names(WC_matches_2022_22)[names(WC_matches_2022_22) == "yellow.cards.team2"]    <- "Away.Yellow.Card.Count"
names(WC_matches_2022_22)[names(WC_matches_2022_22) == "red.cards.team1"]       <- "Home.Red.Card.Count"
names(WC_matches_2022_22)[names(WC_matches_2022_22) == "red.cards.team2"]       <- "Away.Red.Card.Count"
names(WC_matches_2022_22)[names(WC_matches_2022_22) == "total.attempts.team1"]  <- "hshots"
names(WC_matches_2022_22)[names(WC_matches_2022_22) == "total.attempts.team2"]  <- "ashots"
names(WC_matches_2022_22)[names(WC_matches_2022_22) == "on.target.attempts.team1"] <- "hshotsOnTarget"
names(WC_matches_2022_22)[names(WC_matches_2022_22) == "on.target.attempts.team2"] <- "ashotsOnTarget"
names(WC_matches_2022_22)[names(WC_matches_2022_22) == "fouls.team1"]           <- "hfouls"
names(WC_matches_2022_22)[names(WC_matches_2022_22) == "fouls.team2"]           <- "afouls"
names(WC_matches_2022_22)[names(WC_matches_2022_22) == "possession.team1"]      <- "hPossession"
names(WC_matches_2022_22)[names(WC_matches_2022_22) == "possession.team2"]      <- "aPossession"

# remplacer les valeurs manquantes dans WC_database avec les valeurs correspondantes dans WC_matches_2022_22
WC_database$Home <- tolower(trimws(WC_database$Home))
WC_database$Away <- tolower(trimws(WC_database$Away))
WC_database$Year <- as.integer(WC_database$Year)

WC_matches_2022_22$Home <- tolower(trimws(WC_matches_2022_22$Home))
WC_matches_2022_22$Away <- tolower(trimws(WC_matches_2022_22$Away))
WC_matches_2022_22$Year <- as.integer(WC_matches_2022_22$Year)

for (i in 1:nrow(WC_database)) {
  if (is.na(WC_database$hshots[i]) && WC_database$Year[i] == 2022) {
    home_team <- WC_database$Home[i]
    away_team <- WC_database$Away[i]
    year      <- WC_database$Year[i]
    matching_row <- match(paste(home_team, away_team, year),
                          paste(WC_matches_2022_22$Home, WC_matches_2022_22$Away, WC_matches_2022_22$Year))
    WC_database$hshots[i]                 <- WC_matches_2022_22$hshots[matching_row]
    WC_database$ashots[i]                 <- WC_matches_2022_22$ashots[matching_row]
    WC_database$hPossesion[i]             <- WC_matches_2022_22$hPossession[matching_row]
    WC_database$aPossesion[i]             <- WC_matches_2022_22$aPossession[matching_row]
    WC_database$hshotsOnTarget[i]         <- WC_matches_2022_22$hshotsOnTarget[matching_row]
    WC_database$ashotsOnTarget[i]         <- WC_matches_2022_22$ashotsOnTarget[matching_row]
    WC_database$hfouls[i]                 <- WC_matches_2022_22$hfouls[matching_row]
    WC_database$afouls[i]                 <- WC_matches_2022_22$afouls[matching_row]
    WC_database$Home.Yellow.Card.Count[i] <- WC_matches_2022_22$Home.Yellow.Card.Count[matching_row]
    WC_database$Away.Yellow.Card.Count[i] <- WC_matches_2022_22$Away.Yellow.Card.Count[matching_row]
    WC_database$Home.Red.Card.Count[i]    <- WC_matches_2022_22$Home.Red.Card.Count[matching_row]
    WC_database$Away.Red.Card.Count[i]    <- WC_matches_2022_22$Away.Red.Card.Count[matching_row]
    WC_database$Possession.Diff[i]        <- WC_matches_2022_22$Possession.Diff[matching_row]
    WC_database$Shots.Diff[i]             <- WC_matches_2022_22$Shots.Diff[matching_row]
    WC_database$Shots.On.Target.Diff[i]   <- WC_matches_2022_22$Shots.On.Target.Diff[matching_row]
    WC_database$Fouls.Diff[i]             <- WC_matches_2022_22$Fouls.Diff[matching_row]
    WC_database$Yellow.Cards.Diff[i]      <- WC_matches_2022_22$Yellow.Cards.Diff[matching_row]
    WC_database$Red.Cards.Diff[i]         <- WC_matches_2022_22$Red.Cards.Diff[matching_row]
  }
}

#On ajoute une colonne valant 1 si Home gagne et 0 sinon. On peut utiliser la différence de but pour ça (si Home gagne, Diff > 0)
WC_database$Home.Win <- ifelse(WC_database$Goals_Diff > 0, 1, 0)

```

## 2.4 Traitement du classement FIFA

<p class="justify">Afin d'ajouter le classement FIFA de l'année t pour chaque équipe i dans notre modèle, une fonction 'get_rank(year, team)' a été créée pour récupérer le classement FIFA correspondant.</p>

```{r}
FIFA_rank <- read.csv("WC Data/fifa_ranking-2022-12-22 (Rank).csv",
                    header = TRUE,
                    sep = ",",
                    stringsAsFactors = FALSE)

#On garde les dates d'un mois avant chaque Coupe du Monde
FIFA_rank <- subset(FIFA_rank,
                    ifelse(year(FIFA_rank$rank_date) == 2022, 
                    month(FIFA_rank$rank_date) == 10,
                    month(FIFA_rank$rank_date) == 5))
FIFA_rank$rank_date <- as.Date(FIFA_rank$rank_date)
FIFA_rank$Year      <- format(FIFA_rank$rank_date, "%Y")

#On ne garde que les années de la Coupe du Monde
FIFA_rank <- subset(FIFA_rank,year(FIFA_rank$rank_date) %in% c(1994, 1998, 2002, 2006,
                                                               2010, 2014, 2018, 2022))

#Uniformisation des noms de pays
FIFA_rank$country_full <- gsub("USA", "United States", FIFA_rank$country_full)
FIFA_rank$country_full <- gsub("Turkey", "Türkiye", FIFA_rank$country_full)
FIFA_rank$country_full <- gsub("Yugoslavia", "fr Yugoslavia", FIFA_rank$country_full)

FIFA_rank$Year              <- as.integer(FIFA_rank$Year)
FIFA_rank$country_full      <- tolower(FIFA_rank$country_full)
WC_database$FIFA_Rank.Home <- 0
WC_database$FIFA_Rank.Away <- 0

#Fonction qui récupère le classement FIFA d'une équipe pour une année donnée
get_rank <- function(year, team){
  rank <- FIFA_rank$rank[which(FIFA_rank$country_full == team & FIFA_rank$Year == year)]
  if(length(rank) > 0){
    return(rank)
  } else {
    return(NA)
  }
}

#Ajout des classements FIFA dans le dataframe "WC_database"
for (i in 1:nrow(WC_database)) {
  WC_database$FIFA_Rank.Home[i] <- get_rank(WC_database$Year[i], WC_database$Home[i])
  WC_database$FIFA_Rank.Away[i] <- get_rank(WC_database$Year[i], WC_database$Away[i])
}

#Colonne de différence
WC_database$FIFA_Rank.Diff <- WC_database$FIFA_Rank.Home - WC_database$FIFA_Rank.Away
```

## 2.5 Création d'un dataframe par coupe du monde

<p class="justify">Afin de faciliter les estimations futures, le dataframe a été divisé en plusieurs dataframes distincts, chacun correspondant à une édition de la Coupe du Monde.</p>

```{r}
WC_1994 <- subset(WC_database, Year == 1994)
WC_1998 <- subset(WC_database, Year == 1998)
WC_2002 <- subset(WC_database, Year == 2002)
WC_2006 <- subset(WC_database, Year == 2006)
WC_2010 <- subset(WC_database, Year == 2010)
WC_2014 <- subset(WC_database, Year == 2014)
WC_2018 <- subset(WC_database, Year == 2018)
WC_2022 <- subset(WC_database, Year == 2022)
```

# 3. Statistiques descriptives

<p class="justify">Les statistiques descriptives sont utilisées pour mieux appréhender les caractéristiques des données et ainsi pouvoir prendre des décisions analytiques plus éclairées pots estimation.</p>

## 3.1 Moyenne de buts par match

```{r}
plotly::plot_ly(x = c(1994, 1998, 2002, 2006, 2010, 2014, 2018, 2022),
                y = c(mean(c(WC_1994$Home.Goals, WC_1994$Away.Goals)), 
                      mean(c(WC_1998$Home.Goals, WC_1998$Away.Goals)),
                      mean(c(WC_2002$Home.Goals, WC_2002$Away.Goals)), 
                      mean(c(WC_2006$Home.Goals, WC_2006$Away.Goals)),
                      mean(c(WC_2010$Home.Goals, WC_2010$Away.Goals)), 
                      mean(c(WC_2014$Home.Goals, WC_2014$Away.Goals)),
                      mean(c(WC_2018$Home.Goals, WC_2018$Away.Goals)), 
                      mean(c(WC_2022$Home.Goals, WC_2022$Away.Goals))),
                type = "scatter",
                mode = "lines",
                name = "Buts") %>%
      layout(title = "Moyenne de buts par match",
                xaxis = list(title = "Année"),
                yaxis = list(title = "Nombre de buts", range = c(0, 2)))
```

```{r, warning = FALSE}
plotly::plot_ly(x = c(1994, 1998, 2002, 2006, 2010, 2014, 2018, 2022),
                y = c(mean(c(WC_1994$Home.Goals, WC_1994$Away.Goals)),
                      mean(c(WC_1998$Home.Goals, WC_1998$Away.Goals)),
                      mean(c(WC_2002$Home.Goals, WC_2002$Away.Goals)),
                      mean(c(WC_2006$Home.Goals, WC_2006$Away.Goals)),
                      mean(c(WC_2010$Home.Goals, WC_2010$Away.Goals)),
                      mean(c(WC_2014$Home.Goals, WC_2014$Away.Goals)),
                      mean(c(WC_2018$Home.Goals, WC_2018$Away.Goals)),
                      mean(c(WC_2022$Home.Goals, WC_2022$Away.Goals))),
                type = "bar",
                name = "Moyenne de buts") %>%
      add_trace(y = c(mean(c(WC_1994$hshotsOnTarget, WC_1994$ashotsOnTarget), na.rm = TRUE),
                      mean(c(WC_1998$hshotsOnTarget, WC_1998$ashotsOnTarget), na.rm = TRUE),
                      mean(c(WC_2002$hshotsOnTarget, WC_2002$ashotsOnTarget), na.rm = TRUE),
                      mean(c(WC_2006$hshotsOnTarget, WC_2006$ashotsOnTarget), na.rm = TRUE),
                      mean(c(WC_2010$hshotsOnTarget, WC_2010$ashotsOnTarget), na.rm = TRUE),
                      mean(c(WC_2014$hshotsOnTarget, WC_2014$ashotsOnTarget), na.rm = TRUE),
                      mean(c(WC_2018$hshotsOnTarget, WC_2018$ashotsOnTarget), na.rm = TRUE),
                      mean(c(WC_2022$hshotsOnTarget, WC_2022$ashotsOnTarget), na.rm = TRUE)),
                name = "Moyenne de tirs cadrés") %>%
      layout(title = "Moyenne de buts et de tirs cadrés par match",
                xaxis = list(title = "Année"),
                yaxis = list(title = "Nombre de buts et tirs cadrés", range = c(0, 8)))
```

<p class="justify">La moyenne de buts marqués demeure stable à travers les diverses éditions de la Coupe du Monde. Bien que certaines éditions enregistrent un grand nombre de tirs cadrés, la moyenne de buts ne semble pas augmenter.</p>

## 3.2 Moyenne de cartons jaunes et rouges par match

```{r}
plotly::plot_ly(x = c(1994, 1998, 2002, 2006, 2010, 2014, 2018, 2022),
                y = c(mean(c(WC_1994$Home.Yellow.Card.Count, WC_1994$Away.Yellow.Card.Count)),
                      mean(c(WC_1998$Home.Yellow.Card.Count, WC_1998$Away.Yellow.Card.Count)),
                      mean(c(WC_2002$Home.Yellow.Card.Count, WC_2002$Away.Yellow.Card.Count)),
                      mean(c(WC_2006$Home.Yellow.Card.Count, WC_2006$Away.Yellow.Card.Count)),
                      mean(c(WC_2010$Home.Yellow.Card.Count, WC_2010$Away.Yellow.Card.Count)),
                      mean(c(WC_2014$Home.Yellow.Card.Count, WC_2014$Away.Yellow.Card.Count)),
                      mean(c(WC_2018$Home.Yellow.Card.Count, WC_2018$Away.Yellow.Card.Count)),
                      mean(c(WC_2022$Home.Yellow.Card.Count, WC_2022$Away.Yellow.Card.Count))),
                type = "scatter",
                mode = "lines",
                name = "Moyenne de cartons jaunes") %>%
      layout(title = "Moyenne de cartons jaunes par match",
                xaxis = list(title = "Année"),
                yaxis = list(title = "Nombre de cartons jaunes"))
```

```{r}
plotly::plot_ly(x = c(1994, 1998, 2002, 2006, 2010, 2014, 2018, 2022),
                y = c(mean(c(WC_1994$Home.Red.Card.Count, WC_1994$Away.Red.Card.Count)),
                      mean(c(WC_1998$Home.Red.Card.Count, WC_1998$Away.Red.Card.Count)),
                      mean(c(WC_2002$Home.Red.Card.Count, WC_2002$Away.Red.Card.Count)),
                      mean(c(WC_2006$Home.Red.Card.Count, WC_2006$Away.Red.Card.Count)),
                      mean(c(WC_2010$Home.Red.Card.Count, WC_2010$Away.Red.Card.Count)),
                      mean(c(WC_2014$Home.Red.Card.Count, WC_2014$Away.Red.Card.Count)),
                      mean(c(WC_2018$Home.Red.Card.Count, WC_2018$Away.Red.Card.Count)),
                      mean(c(WC_2022$Home.Red.Card.Count, WC_2022$Away.Red.Card.Count))),
                type = "scatter",
                mode = "lines",
                name = "Red Cards") %>%
      layout(title = "Moyenne de carton rouge par match",
                xaxis = list(title = "Année"),
                yaxis = list(title = "Cartons rouges"))

```

```{r}
plotly::plot_ly(x = c(1994, 1998, 2002, 2006, 2010, 2014, 2018, 2022),
                y = c(mean(c(WC_1994$Home.Yellow.Card.Count, WC_1994$Away.Yellow.Card.Count)),
                      mean(c(WC_1998$Home.Yellow.Card.Count, WC_1998$Away.Yellow.Card.Count)),
                      mean(c(WC_2002$Home.Yellow.Card.Count, WC_2002$Away.Yellow.Card.Count)),
                      mean(c(WC_2006$Home.Yellow.Card.Count, WC_2006$Away.Yellow.Card.Count)),
                      mean(c(WC_2010$Home.Yellow.Card.Count, WC_2010$Away.Yellow.Card.Count)),
                      mean(c(WC_2014$Home.Yellow.Card.Count, WC_2014$Away.Yellow.Card.Count)),
                      mean(c(WC_2018$Home.Yellow.Card.Count, WC_2018$Away.Yellow.Card.Count)),
                      mean(c(WC_2022$Home.Yellow.Card.Count, WC_2022$Away.Yellow.Card.Count))),
                type = "scatter",
                mode = "lines",
                name = "Cartons jaunes") %>%
      add_trace(x = c(1994, 1998, 2002, 2006, 2010, 2014, 2018, 2022),
                y = c(mean(c(WC_1994$Home.Red.Card.Count, WC_1994$Away.Red.Card.Count)),
                      mean(c(WC_1998$Home.Red.Card.Count, WC_1998$Away.Red.Card.Count)),
                      mean(c(WC_2002$Home.Red.Card.Count, WC_2002$Away.Red.Card.Count)),
                      mean(c(WC_2006$Home.Red.Card.Count, WC_2006$Away.Red.Card.Count)),
                      mean(c(WC_2010$Home.Red.Card.Count, WC_2010$Away.Red.Card.Count)),
                      mean(c(WC_2014$Home.Red.Card.Count, WC_2014$Away.Red.Card.Count)),
                      mean(c(WC_2018$Home.Red.Card.Count, WC_2018$Away.Red.Card.Count)),
                      mean(c(WC_2022$Home.Red.Card.Count, WC_2022$Away.Red.Card.Count))),
                type = "scatter",
                mode = "lines",
                name = "Cartons rouges") %>%
      layout(title = "Moyenne de cartons par match",
                xaxis = list(title = "Année"),
                yaxis = list(title = "Nombre de cartons"))
```

<p class="justify">Nous pouvons observer une diminution du nombre de cartons jaunes et rouges par match au fil des années de la Coupe du Monde. Cette tendance peut être expliquée par une possible évolution dans la sévérité des arbitres, qui pourraient être de moins en moins stricts dans leur distribution de cartons, ou par une amélioration du comportement disciplinaire des joueurs, notamment depuis l'introduction de la VAR qui permet de mieux contrôler les fautes commises.</p>

# 4. Modèle de régression linéaire

Le modèle de régression linéaire suivant est estimé pour chaque année de la Coupe du Monde :

\[\Delta \text{Buts}_t^i = \beta_0 + \beta_1 \Delta \text{Rank}_t^i + \beta_2 \Delta \text{X}_t^i + \beta_3 \text{Attendence}_t^i + \varepsilon_t^i\]

<p class="justify">avec le match i, de l'année de coupe du monde t, et $\Delta \text{X}_t^i$ le vecteur des variables de contrôles. Le contenu du vecteur $X$ varie selon les années en fonction des données disponibles. À partir de 2006, les variables de contrôle comprennent la différence du nombre de cartons jaunes, rouges, de fautes, de possession, de tirs et de tirs cadrés. Dans certaines années, la différence du nombre d'arrêts est également incluse.</p>

## 4.1 Estimations des modèles des modèles

<p class="justify">On divise les différentes Coupes du Monde en deux sous ensemble : 1994, 1998 et 2002, et 2006, 2010, 2014, 2018 et 2022. La répartition permet de regroupés les modèles pour lesquels nous avons peu de variables de contrôle de ceux pour lesquels nous en avons plusieurs.</p>

```{r}
#Groupe 1
model_1994 <- lm(Goals_Diff ~ FIFA_Rank.Diff + Yellow.Card.Diff +
                              Red.Card.Diff  + Attendance,
                              data = WC_1994)
model_1998 <- lm(Goals_Diff ~ FIFA_Rank.Diff + Yellow.Card.Diff +
                              Red.Card.Diff  + Attendance,
                              data = WC_1998)
model_2002 <- lm(Goals_Diff ~ FIFA_Rank.Diff + Yellow.Card.Diff +
                              Red.Card.Diff  + Attendance,
                              data = WC_2002)

#Groupe 2
model_2006 <- lm(Goals_Diff ~ FIFA_Rank.Diff + Yellow.Card.Diff + Red.Card.Diff +
                              Fouls.Diff     + Possession.Diff  + Shots.Diff    +
                              Shots.On.Target.Diff + Saves.Diff + Attendance,
                              data = WC_2006)
model_2010 <- lm(Goals_Diff ~ FIFA_Rank.Diff + Yellow.Card.Diff + Red.Card.Diff +
                              Fouls.Diff     + Possession.Diff  + Shots.Diff    +
                              Shots.On.Target.Diff + Saves.Diff + Attendance,
                              data = WC_2010)
model_2014 <- lm(Goals_Diff ~ FIFA_Rank.Diff + Yellow.Card.Diff + Red.Card.Diff +
                              Fouls.Diff     + Possession.Diff  + Shots.Diff    +
                              Shots.On.Target.Diff + Saves.Diff + Attendance,
                              data = WC_2014)
model_2018 <- lm(Goals_Diff ~ FIFA_Rank.Diff + Yellow.Card.Diff + Red.Card.Diff +
                              Fouls.Diff     + Possession.Diff  + Shots.Diff    +
                              Shots.On.Target.Diff + Saves.Diff + Attendance,
                              data = WC_2018)
model_2022 <- lm(Goals_Diff ~ FIFA_Rank.Diff + Yellow.Card.Diff + Red.Card.Diff +
                              Fouls.Diff     + Possession.Diff  + Shots.Diff    +
                              Shots.On.Target.Diff + Attendance,
                              data = WC_2022)

```

## 4.2 Tests d'hétéroscédasticité et de multicolinéarité

<p class="justify">Il est suspecté qu'il y ait une multicolinéarité au sein des variables de contrôle car certaines d'entre elles sont corrélées entre elles (par exemple, le nombre de tirs et le nombre de tirs cadrés). Le test VIF est utilisé pour examiner cela. En même temps, on teste l'hétéroscédasticité des résidus pour s'assurer que les hypothèses fondamentales de la régression linéaire sont respectées, en particulier la constance de la variance des résidus.</p>

```{r}
#Test de White (hétéroscédasticité)
bp_1994 <- bptest(model_1994, ~ FIFA_Rank.Diff + Yellow.Card.Diff +
                                Red.Card.Diff  + Attendance +
                                I(FIFA_Rank.Diff^2) + I(Yellow.Card.Diff^2) +
                                I(Red.Card.Diff^2)  + I(Attendance^2),
                                data = WC_1994)

bp_1998 <- bptest(model_1998, ~ FIFA_Rank.Diff + Yellow.Card.Diff +
                                Red.Card.Diff  + Attendance +
                                I(FIFA_Rank.Diff^2) + I(Yellow.Card.Diff^2) +
                                I(Red.Card.Diff^2)  + I(Attendance^2),
                                data = WC_1998)

bp_2002 <- bptest(model_2002, ~ FIFA_Rank.Diff + Yellow.Card.Diff +
                                Red.Card.Diff  + Attendance +
                                I(FIFA_Rank.Diff^2) + I(Yellow.Card.Diff^2) +
                                I(Red.Card.Diff^2)  + I(Attendance^2),
                                data = WC_2002)

bp_2006 <- bptest(model_2006, ~ FIFA_Rank.Diff + Yellow.Card.Diff + Red.Card.Diff +
                                Fouls.Diff     + Possession.Diff  + Shots.Diff    +
                                Shots.On.Target.Diff + Saves.Diff + Attendance +
                                I(FIFA_Rank.Diff^2) + I(Yellow.Card.Diff^2) + I(Red.Card.Diff^2) +
                                I(Fouls.Diff^2)     + I(Possession.Diff^2)  + I(Shots.Diff^2)    +
                                I(Shots.On.Target.Diff^2) + I(Saves.Diff^2) + I(Attendance^2),
                                data = WC_2006)

bp_2010 <- bptest(model_2010, ~ FIFA_Rank.Diff + Yellow.Card.Diff + Red.Card.Diff +
                                Fouls.Diff     + Possession.Diff  + Shots.Diff    +
                                Shots.On.Target.Diff + Saves.Diff + Attendance +
                                I(FIFA_Rank.Diff^2) + I(Yellow.Card.Diff^2) + I(Red.Card.Diff^2) +
                                I(Fouls.Diff^2)     + I(Possession.Diff^2)  + I(Shots.Diff^2)    +
                                I(Shots.On.Target.Diff^2) + I(Saves.Diff^2) + I(Attendance^2),
                                data = WC_2010)

bp_2014 <- bptest(model_2014, ~ FIFA_Rank.Diff + Yellow.Card.Diff + Red.Card.Diff +
                                Fouls.Diff     + Possession.Diff  + Shots.Diff    +
                                Shots.On.Target.Diff + Saves.Diff + Attendance +
                                I(FIFA_Rank.Diff^2) + I(Yellow.Card.Diff^2) + I(Red.Card.Diff^2) +
                                I(Fouls.Diff^2)     + I(Possession.Diff^2)  + I(Shots.Diff^2)    +
                                I(Shots.On.Target.Diff^2) + I(Saves.Diff^2) + I(Attendance^2),
                                data = WC_2014)

bp_2018 <- bptest(model_2018, ~ FIFA_Rank.Diff + Yellow.Card.Diff + Red.Card.Diff +
                                Fouls.Diff     + Possession.Diff  + Shots.Diff    +
                                Shots.On.Target.Diff + Saves.Diff + Attendance +
                                I(FIFA_Rank.Diff^2) + I(Yellow.Card.Diff^2) + I(Red.Card.Diff^2) +
                                I(Fouls.Diff^2)     + I(Possession.Diff^2)  + I(Shots.Diff^2)    +
                                I(Shots.On.Target.Diff^2) + I(Saves.Diff^2) + I(Attendance^2),
                                data = WC_2018)

bp_2022 <- bptest(model_2022, ~ FIFA_Rank.Diff + Yellow.Card.Diff + Red.Card.Diff +
                                Fouls.Diff     + Possession.Diff  + Shots.Diff    +
                                Shots.On.Target.Diff + Attendance +
                                I(FIFA_Rank.Diff^2) + I(Yellow.Card.Diff^2) + I(Red.Card.Diff^2) +
                                I(Fouls.Diff^2)     + I(Possession.Diff^2)  + I(Shots.Diff^2)    +
                                I(Shots.On.Target.Diff^2) + I(Attendance^2),
                                data = WC_2022)

#Test VIF (multicolinéarité)
vif_1994 <- vif(model_1994)[1]
vif_1998 <- vif(model_1998)[1]
vif_2002 <- vif(model_2002)[1]
vif_2006 <- vif(model_2006)[1]
vif_2010 <- vif(model_2010)[1]
vif_2014 <- vif(model_2014)[1]
vif_2018 <- vif(model_2018)[1]
vif_2022 <- vif(model_2022)[1]

#Tableau récapitulatif des tests
tests <- data.frame(Model      = c("1994", "1998", "2002", "2006", "2010", "2014", "2018", "2022"),
                    White_p.value = round(c(bp_1994$p.value, bp_1998$p.value, bp_2002$p.value,
                                         bp_2006$p.value, bp_2010$p.value, bp_2014$p.value,
                                         bp_2018$p.value, bp_2022$p.value), 4),
                    VIF_Value  = round(c(vif_1994, vif_1998, vif_2002,
                                         vif_2006, vif_2010, vif_2014,
                                         vif_2018, vif_2022), 4))
tests
```

<p class="justify">Les résultats révèlent que les valeurs de VIF sont inférieures à 10, suggérant que les variables ne présentent pas de corrélation. Pour la période de 2014 à 2022, les p-values du test de White sont inférieures à 0,05, indiquant ainsi que les résidus ne suivent pas une distribution homoscédastique. Toutefois, pour la période de 1994 à 2002, les p-values du test de White sont supérieures à 0,05, ce qui suggère que les résidus sont homoscédastiques. Afin de corriger cette hétéroscédasticité, nous allons utiliser la méthode de White.</p>

```{r}
model_2022_corrige <- coeftest(model_2022, vcov = vcovHC(model_2022, type = "HC1"))
model_2018_corrige <- coeftest(model_2018, vcov = vcovHC(model_2018, type = "HC1"))
model_2014_corrige <- coeftest(model_2014, vcov = vcovHC(model_2014, type = "HC1"))

stargazer(model_2022, model_2022_corrige, type = "text", digits = 3,
          title = "Modèle de régression linéaire pour la Coupe du Monde 2022", 
          column.labels = c("Non corrigé", "Corrigé"))

stargazer(model_2018, model_2018_corrige, type = "text", digits = 3,
          title = "Modèle de régression linéaire pour la Coupe du Monde 2018", 
          column.labels = c("Non corrigé", "Corrigé"))

stargazer(model_2014, model_2014_corrige, type = "text", digits = 3,
          title = "Modèle de régression linéaire pour la Coupe du Monde 2014", 
          column.labels = c("Non corrigé", "Corrigé"))

```

L'hétéroscédasticité semble avoir été corrigée.

## 4.3 Résultats

```{r}
stargazer(model_1994, model_1998, model_2002,
          type = "text",
          digits = 3,
          title = "Modèle de régression linéaire pour la Coupe du Monde 1994, 1998 et 2002", 
          column.labels = c("1994", "1998", "2002"))

stargazer(model_2006, model_2010, model_2014, model_2018, model_2022,
          type = "text",
          digits = 3,
          df = FALSE,
          title = "Modèle de régression linéaire pour la Coupe du Monde 2006, 2010 et 2014", 
          column.labels = c("2006", "2010", "2014", "2018", "2022"))

#Modèles corrigés
stargazer(model_2014_corrige, model_2018_corrige, model_2022_corrige,
          type = "text",
          digits = 3,
          df = FALSE,
          title = "Modèle de régression linéaire pour la Coupe du Monde 2014, 2018 et 2022", 
          column.labels = c("2014", "2018", "2022"))
```

<p class="justify">Dans le groupe des Coupes du Monde de 1994, 1998 et 2002, le seul coefficient significatif pour tous les modèles est celui lié à la variable de différence de classement FIFA. Le coefficient négatif significatif indique que les équipes ayant un classement FIFA plus élevé ont tendance à marquer plus de buts que les autres équipes. De plus, la variable de différence de carton rouge est significative et négative pour l'année 2002. Cela implique qu'un carton rouge est associé à une diminution du nombre de buts marqués, toutes choses étant égales par ailleurs. Cela peut suggérer que les équipes qui reçoivent plus de cartons rouges ont du mal à maintenir leur stratégie de jeu, ce qui peut affaiblir leur performance sur le terrain et leur capacité à marquer.</p>
  
<p class="justify">Contrairement à la conclusion de Saumik Paul et Ronita Mitra, le coefficient associé à la variable d'affluence ne peut pas être interprété, car il n'est pas significatif au seuil de 5% et est très proche de 0. De même, le coefficient associé à la variable de différence de carton jaune n'est pas significatif et ne peut donc pas être interprété.</p>
  
<p class="justify">De manière plus générale, on constate que le coefficient de détermination $R²$ est en moyenne de 0.2 sur nos 3 modèles. Cela signifie que seulement 20% de la variation de la différence de buts est expliquée en moyenne par le modèle, permettant de conclure qu'il n'est pas correctement estimé.</p>
<br>
<br>
  
<p class="justify">Dans le deuxième groupe, qui concerne les Coupes du Monde de 2006, 2010, 2014, 2018 et 2022, il y a beaucoup plus de variables significatives même si le classement FIFA n'est désormais plus significatif pour toutes les éditions de la Coupe du Monde. Cela peut être dû à l'ajout de variables de contrôle qui capturent des aspects importants des performances des équipes liés au classement FIFA mais qui ne sont pas mesurés directement par celui-ci.</p>

<p class="justify">On observe que les variables de possession de balle ainsi que celles des cartons jaunes ne sont pas significatives. Cela indique que le fait de garder davantage la balle ou d'être plus agressif n'a pas d'impact sur la différence de but finale.</p>
  
<p class="justify">En revanche, les variables de tirs cadrés et d'arrêts sont significatives et positives au seuil de 5% pour chaque édition de la Coupe du Monde. Les équipes qui ont plus de tirs cadrés ont tendance à marquer plus de buts. Cela vient contraster avec la non-significativité du coefficient associé à la variable tir. En effet, le simple fait de tirer plus au but n'augmente pas nécessairement la probabilité de marquer selon notre modèle. La variable de différence d'arrêt donne la réflexion inverse de la variable tir : plus une équipe a un bon gardien et une défense solide, moins elle a de chance de concéder un but.</p>
  
<p class="justify">Le modèle appliqué au deuxième groupe de Coupe du Monde se démarque par sa fiabilité, en contraste avec celui appliqué au premier groupe. En effet, le coefficient de détermination $R²$ présente une moyenne de 0,63, ce qui révèle que le modèle peut expliquer en moyenne 62% de la variation de la différence de buts. Il est à noter que pour l'édition 2018, le modèle peut expliquer jusqu'à 90% de cette variation, témoignant ainsi de la pertinence de ses prévisions.</p>

# 5. Modèle probit

<p class="justify">A la différence du modèle MCO, le modèle probit cherche à prédire une variable binaire. Les variables explicatives sont des variables continues mais la variable expliquée prend oui/non comme valeur.</p>

\begin{equation}
Win_{t}^{i} = \alpha_{t} + \beta_{1,t} \cdot Rank_{t}^{i} + \beta_{2,t} \cdot X_{t}^{i} + \epsilon_{t}^{i}
\end{equation}

où :

- $Win_{t}^{i}$ est une variable dummy qui mesure si le match i de la coupe du monde t a été gagné par l'équipe qui joue à domicile ou non.

- $Rank_{t}^{i}$ est le rang de l'équipe qui joue à domicile.

- $X_{t}^{i}$ est un vecteur comprenant les variables de contrôle telles que le nombre de carton jaune, le nombre de carton rouge, le nombre de tirs cadrés, etc.


Le modèle peut se réécrire comme suit :

$$ P(Win_{t}^{i}=1 | Rank_{t}^{i},X_{t}^{i}) = \Phi(\alpha + \beta_1 Rank_{t}^{i} + \beta_2 X_{t}^{i} + \epsilon_{t}^{i}) $$

où $\Phi$ représente la fonction de répartition cumulative de la distribution normale standard.<p class="justify">

<p class="justify">On dit que la probabilité que l'équipe $i$ gagne le match de la Coupe du Monde $t$ étant donné son classement $Rank_{t}^{i}$ et les variables de contrôles $X_{t}^{i}$ est donnée par la fonction de répartition cumulative de la variable aléatoire normale standardisée $\alpha + \beta_1 Rank_{t}^{i} + \beta_2 X_{t}^{i} + \epsilon_{t}^{i}$. En d'autres termes, $\Phi$ calcule la probabilité que la variable aléatoire suit une distribution normale standard et prend une valeur inférieure ou égale à une certaine valeur donnée.</p>

## 5.1 Nouveau dataframe

<p class="justify">Contrairement au modèle de régression linéaire précédent où chaque match était considéré comme une seule observation, le modèle probit prend en compte deux observations pour chaque match. Par match, il y a deux équipes, chacune ayant une probabilité de gagner différente, ce qui nécessite d'examiner chaque match du point de vue de l'équipe à domicile et de celui de l'équipe à l'extérieur.</p>

<p class="justify">Nous avons donc fait un nouveau dataframe qui empile les données, ne regardant plus chaque équipe comme à domicile ou à l'extérieur, mais comme "gagne ou ne gagne pas". Cette nouvelle variable représentera notre dummy.</p>

```{r}
WC_Probit <- data.frame()

for (i in 1:nrow(WC_database)) {
  #Equipe à domicile
  home_team            <- WC_database[i, "Home"]
  home_goals           <- WC_database[i, "Home.Goals"]
  home_red_cards       <- WC_database[i, "Home.Red.Card.Count"]
  home_yellow_cards    <- WC_database[i, "Home.Yellow.Card.Count"]
  home_substitutions   <- WC_database[i, "Home.Substitution.Count"]
  home_possession      <- WC_database[i, "hPossesion"]
  home_shots_on_target <- WC_database[i, "hshotsOnTarget"]
  home_shots           <- WC_database[i, "hshots"]
  home_fouls           <- WC_database[i, "hfouls"]
  home_saves           <- WC_database[i, "hsaves"]

  #Equipe à l'extérieur
  away_team             <- WC_database[i, "Away"]
  away_goals            <- WC_database[i, "Away.Goals"]
  away_red_cards        <- WC_database[i, "Away.Red.Card.Count"]
  away_yellow_cards     <- WC_database[i, "Away.Yellow.Card.Count"]
  away_substitutions    <- WC_database[i, "Away.Substitution.Count"]
  away_possession       <- WC_database[i, "aPossesion"]
  away_shots_on_target  <- WC_database[i, "ashotsOnTarget"]
  away_shots            <- WC_database[i, "ashots"]
  away_fouls            <- WC_database[i, "afouls"]
  away_saves            <- WC_database[i, "asaves"]
  
  home_observation <- data.frame(Team = home_team,
                                 Goals = home_goals,
                                 Red_Cards = home_red_cards,
                                 Yellow_Cards = home_yellow_cards,
                                 Substitutions = home_substitutions,
                                 Possession = home_possession,
                                 Shots_On_Target = home_shots_on_target,
                                 Shots = home_shots,
                                 Fouls = home_fouls,
                                 Saves = home_saves,
                                 Win = ifelse(home_goals > away_goals, 1, 0),
                                 Year = WC_database[i, "Year"],
                                 Round = WC_database[i, "Round"])
  
  away_observation <- data.frame(Team = away_team,
                                 Goals = away_goals,
                                 Red_Cards = away_red_cards,
                                 Yellow_Cards = away_yellow_cards,
                                 Substitutions = away_substitutions,
                                 Possession = away_possession,
                                 Shots_On_Target = away_shots_on_target,
                                 Shots = away_shots,
                                 Fouls = away_fouls,
                                 Saves = away_saves,
                                 Win = ifelse(away_goals > home_goals, 1, 0),
                                 Year = WC_database[i, "Year"],
                                 Round = WC_database[i, "Round"])
  
  WC_Probit <- rbind(WC_Probit, home_observation, away_observation)
}

WC_Probit <- merge(WC_Probit, FIFA_rank,
                   by.x = c("Team", "Year"),
                   by.y = c("country_full", "Year"),
                   all.x = TRUE)
WC_Probit <- WC_Probit[,-c(15:20)]
```

## 5.2 Estimation des modèles

### 5.2.1 Modèle probit pour 1994, 1998 et 2002

<p class="justify">Les données disponibles pour ces 3 éditions de Coupe du monde sont limitées, nous estimons donc les 3 modèle à part.</p>

```{r}
#CDM 1994
model_probit_1994 <- glm(Win ~ rank + Goals + Yellow_Cards + Red_Cards,
                               data = WC_Probit[WC_Probit$Year == 1994,],
                               family = binomial(link = "logit"))

#CDM 1998
model_probit_1998 <- glm(Win ~ rank + Goals + Yellow_Cards + Red_Cards,
                               data = WC_Probit[WC_Probit$Year == 1998,],
                               family = binomial(link = "logit"))

#CDM 2002
model_probit_2002 <- glm(Win ~ rank + Goals + Yellow_Cards + Red_Cards,
                               data = WC_Probit[WC_Probit$Year == 2002,],
                               family = binomial(link = "logit"))
```

### 5.2.2 Modèle probit pour 2006, 2010, 2014, 2018 et 2022

```{r}
model_probit_2006 <- glm(Win ~ rank + Goals + Yellow_Cards  +
                               Red_Cards    + Substitutions +
                               Possession   + Shots         +
                               Shots_On_Target + Fouls      +
                               Saves,
                               na.action = na.exclude,
                               data = WC_Probit[WC_Probit$Year == 2006,],
                               family = binomial(link = "logit"))


#CDM 2010
model_probit_2010 <- glm(Win ~ rank + Goals + Yellow_Cards  +
                               Red_Cards    + Substitutions +
                               Possession   + Shots         +
                               Shots_On_Target + Fouls      +
                               Saves,
                               na.action = na.exclude,
                               data = WC_Probit[WC_Probit$Year == 2010,],
                               family = binomial(link = "logit"))

#CDM 2014
model_probit_2014 <- glm(Win ~ rank + Goals + Yellow_Cards  +
                               Red_Cards    + Substitutions +
                               Possession   + Shots         +
                               Shots_On_Target + Fouls      +
                               Saves,
                               na.action = na.exclude,
                               data = WC_Probit[WC_Probit$Year == 2014,],
                               family = binomial(link = "logit"))

#CDM 2018
model_probit_2018 <- glm(Win ~ rank + Goals + Yellow_Cards  +
                               Red_Cards    + Substitutions +
                               Possession   + Shots         +
                               Shots_On_Target + Fouls      +
                               Saves,
                               na.action = na.exclude,
                               data = WC_Probit[WC_Probit$Year == 2018,],
                               family = binomial(link = "logit"))

#CDM 2022
model_probit_2022 <- glm(Win ~ rank + Goals + Yellow_Cards  +
                               Red_Cards    + Substitutions +
                               Possession   + Shots         +
                               Shots_On_Target + Fouls,
                               na.action = na.exclude,
                               data = WC_Probit[WC_Probit$Year == 2022,],
                               family = binomial(link = "logit"))
```

## 5.3 Résultats

```{r}
stargazer(model_probit_1994, model_probit_1998, model_probit_2002,
          type = "text",
          title = "Probit model for the World Cup 1994, 1998 and 2002",
          column.labels = c("1994", "1998", "2002"),
          dep.var.labels = "Win")

stargazer(model_probit_2006, model_probit_2010, model_probit_2014,
          type = "text",
          title = "Probit model for the World Cup 2006, 2010, 2014",
          column.labels = c("2006", "2010", "2014", "2018", "2022"),
          dep.var.labels = "Win")

stargazer(model_probit_2018, model_probit_2022,
          type = "text",
          title = "Probit model for the World Cup 2018 and 2022",
          column.labels = c("2018", "2022"),
          dep.var.labels = "Win")
```


<p class="justify">Le coefficient relatif à la variable du nombre de buts marqués est systématiquement positif et significatif dans tous les modèles. En effet, cela semble logique car marquer des buts accroît les chances de gagner. Quant au coefficient associé aux variables cartons jaunes et rouges, il ne présente pas toujours une significativité statistique et son signe varie selon les éditions de la Coupe du Monde. Lorsqu'il est positif, cela indique que le fait de recevoir un carton jaune ou rouge peut accroître la probabilité de remporter le match, tandis qu'un coefficient négatif indique une diminution de cette probabilité. L'alternance de signe de ce coefficient révèle que le style de jeu défensif efficace (agressif ou plutôt passif) varie selon les éditions de la compétition.</p>

<p class="justify">L'absence de signification du classement FIFA indique que cette mesure n'est guère un indicateur fiable des résultats d'un match de la Coupe du Monde. En effet, le classement FIFA est établi en utilisant une méthode discrète qui tient compte des performances passées de l'équipe. Toutefois, cette approche peut ne pas rendre compte avec exactitude de la qualité actuelle de l'équipe ou de son aptitude à gagner des matches dans le cadre particulier de la Coupe du Monde, qui diffère de toute autre phase éliminatoire ou compétition.</p>

<p class="justify">Quant aux coefficients relatifs aux tirs et tirs cadrés, ils ne sont significatifs qu'au cours de l'édition de 2014. Cette situation peut paraître surprenante, car l'on pourrait supposer que les équipes qui tirent le plus souvent et le plus précisément ont une plus grande probabilité de marquer des buts et, partant, de remporter la victoire. Cependant, il existe plusieurs raisons pour lesquelles ces variables peuvent ne pas être significatives dans les modèles. Tout d'abord, la précision et le nombre de tirs ne sont que des indicateurs de la performance offensive, tandis que d'autres facteurs tels que la performance défensive peuvent s'avérer plus importants pour la victoire. En outre, la qualité des tirs, comme leur lieu, leur moment et leur contexte, peut influer sur le résultat et n'est pas prise en compte dans ce modèle.</p>

# 6. Conclusion

<p class="justify">Comme le soulignent les auteurs dans leur conclusion, l'utilisation du classement FIFA en tant qu'indicateur de performance d'une équipe est sujette à controverse. Bien que cet outil puisse être considéré comme pertinent pour certaines éditions de la Coupe du Monde, les événements imprévus peuvent toutefois remettre en question sa pertinence. La performance remarquable de la Russie, menée par le joueur talentueux Denis Cheryshev, qui a réussi à se hisser jusqu'en quart de finale lors de la Coupe du Monde 2018, ou encore la victoire de l'Arabie Saoudite contre l'Argentine, qui a finalement remporté le titre en 2022, illustrent ces surprises récurrentes. En somme, il est indéniable que ces résultats inattendus peuvent émerger à tout moment et qu'il est donc difficile de prédire avec précision les performances des équipes. Néanmoins, en dehors de ces événements imprévisibles, le classement FIFA demeure un indicateur relativement fiable sur le plan empirique.</p>